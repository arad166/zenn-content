---
title: "LabVIEWで3D迷路を作る"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

# 0.はじめに
LabVIEWに慣れるために、LabVIEWで3D迷路を作りました。
この記事はその作成過程と学んだことをまとめたものです。
Githubリポジトリは[こちら](https://github.com/arad166/LabVIEW_3Dmaze)です。

# 1. 迷路を生成する
最終的には一人称視点の3D迷路を作りますが、その前段階として2Dで迷路を生成します。
迷路生成にはさまざまなアルゴリズムがありますが、今回は実装が比較的シンプルな**穴掘り法**を選びました。
**穴掘り法**とは、
「ランダムに掘り進め、行き止まりにぶつかったら戻る」
という操作を繰り返して迷路を作るアルゴリズムです。

![](https://storage.googleapis.com/zenn-user-upload/eb45b38766db-20250818.png)
*このような迷路が生成されます（白が通路、黒が壁）*
通路を`0` 、壁を`1`とした二次元配列を用意し、それを Intensity Graph で描画することで迷路を表現しました。

アルゴリズム自体は再帰で実装できます。具体的には「ランダムに掘り進める処理」をサブVI化し、そのサブVIが自分自身を呼び出すようにします。
※自分自身を呼び出すには、`File > VI Properties > Execution`から`Reentrancy`を`Shared clone reentrant execution`に設定しておく必要があります。

これで迷路自体は生成できましたが、今後の実装のために「0/1の行列」ではなく「壁の集合」として管理する形に変えます。
方法はシンプルで、通路と壁の境界、そして外周に壁を配置すればよいです。

実装では、壁を「線分」として

$$
(x_1,y_1) \rightarrow (x_2,y_2)
$$

を表す配列 $(x_1, y_1, x_2, y_2)$ の形で管理しました。
迷路は「線分の集合」として表現できるので、二次元配列にこれらの線分を格納して管理しました。

この線分の集合を描画したいところですが、LabVIEW には（私の知る限り）複数の線分を直接描画する関数が存在しません。
そこで代替手段として、線分上に等間隔で点を10個打ち、点列として描画する方法を取りました。
![](https://storage.googleapis.com/zenn-user-upload/bbaca75cf488-20250818.png)
*XY graphで描画するとこのようになります。*

# 2. プレイヤーを動かせるようにする
プレイヤーの情報としては
- $x$: x座標
- $y$: y座標
- $\theta$: 向き

の3つがあれば十分なので、この $(x,y,\theta)$ をクラスタ化して保持します。例えば、$(2,4,\pi/2)$ はプレイヤーが $(2,4)$ にいて、x軸正の向きに対して $\pi/2$ 回転している状態を表します。
![](https://storage.googleapis.com/zenn-user-upload/75e1a2ce554d-20250819.png)
*こんな感じ*

これらの情報をキーボードの十字キー入力によって変更できるようにします。
左キー、右キーにはそれぞれ左回転、右回転を割り当てますが、これは $\theta$ を増減させれば良いです。
上キー、下キーにはそれぞれ前進、後退を割り当てます。この部分の実装には三角関数を使います。




# 3. 迷路を3Dで描画する

# 4. 完成